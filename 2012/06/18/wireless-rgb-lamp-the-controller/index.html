<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="/public/favicon.ico" rel="shortcut icon" type="image/x-icon">
    <link href="http://gmpg.org/xfn/11" rel="profile">

    <title>
      Wireless RGB lamp - The controller &middot; 
      Zápisník Josefa Rouska
    </title>

    <meta content="Zápisník Josefa Rouska" property="og:site_name">
    
      <meta content="Wireless RGB lamp - The controller" property="og:title">
    
    
      <meta content="article" property="og:type">
      <meta property="article:author" content="https://www.facebook.com/josef.rousek" />
    
    
      <meta name="description" content="In this part I will show you how to control RGB lamp using Netduino. The basics such as wiring XBee to Netduino and XBee setup are described in my previous article, so I will highlight only most interesting bits.">
      <meta content="In this part I will show you how to control RGB lamp using Netduino. The basics such as wiring XBee to Netduino and XBee setup are described in my previous article, so I will highlight only most interesting bits." property="og:description">
    
    
      <meta content="https://blog.rousek.name/2012/06/18/wireless-rgb-lamp-the-controller/" property="og:url">
    
    
      <meta content="2012-06-18T00:00:00-05:00" property="article:published_time">
    
    

    <!-- CSS -->
    <link rel="stylesheet" href="/public/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Abril+Fatface&subset=latin,latin-ext">

    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/public/favicon.png">

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

    <script async defer data-domain="blog.rousek.name" src="https://plausible.io/js/plausible.js"></script>
  </head>
  <body>

    <header class="masthead">
      <div class="masthead-inner">
        <h1><a href="/">Zápisník Josefa Rouska</a></h1>
        <p class="lead">Python a React.js programátor, zaměřený na Shopify integrace</p>

        <div class="colophon">
          <ul class="colophon-links">
            <li><a href="https://rousek.name/">about</a></li>
            <li><a href="https://github.com/stlk">github</a></li>
            <li><a href="https://twitter.com/josefrousek">twitter</a></li>
          </ul>
        </div>

      </div>
    </header>

    <div class="content container">
      <div class="post">
  <h1>Wireless RGB lamp - The controller</h1>
  <span class="post-date">18 Jun 2012</span>
  <p>In this part I will show you how to control <a href="http://rousek.name/blog/wireless-rgb-lamp" title="Link to my previous post">RGB lamp</a> using Netduino. The basics such as <a href="http://rousek.name/blog/control-lights-remotely-using-xbee-and-netduino" title="Link to another blog post">wiring XBee to Netduino and XBee setup</a> are described in my previous article, so I will highlight only most interesting bits.</p>

<p>Method <code class="language-plaintext highlighter-rouge">RequestReceived</code> handles incoming HTTP requests and decides which command send to XBee.</p>

<p>If URL is (your XBee’s IP)/fade/1000 where 1000 is delay in milliseconds, following code is executed. Because highest number we can squeeze to one byte is 255 we need to use two bytes to achieve more suitable range 0 - 65535. We then need to split that number into two bytes as shown below.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>short fadeDelay = short.Parse(param[2]); // param[2] is delay in milliseconds
_xBee.SendData(0x0013A200407A26AA, 0xFFFE,
                new byte[]
                    {
                        20,
                        (byte) (fadeDelay &gt;&gt; 8),
                        (byte) (fadeDelay &amp; 0x00FF)
                    }, null);
</code></pre></div></div>

<p>Following two commands are simple. Just parse number and send it.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>case "mode":
    if (param.Length == 3)
    {
        byte fadeMode = byte.Parse(param[2]);
        _xBee.SendData(0x0013A200407A26AA, 0xFFFE, new byte[] { 21, fadeMode }, null);
    }
    break;
case "color":
    if (param.Length == 3)
    {
        byte color = byte.Parse(param[2]);
        _xBee.SendData(0x0013A200407A26AA, 0xFFFE, new byte[] { 22, color }, null);
    }
    break;
</code></pre></div></div>

<p>Command <em>colorx</em> takes 3 arguments. So URL will look like this (your XBee’s IP)/colorx/(0-255 red)/(0-255 green)/(0-255 blue)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>byte colorR = byte.Parse(param[2]);
byte colorG = byte.Parse(param[3]);
byte colorB = byte.Parse(param[4]);
_xBee.SendData(0x0013A200407A26AA, 0xFFFE, new byte[] { 23, colorR, colorG, colorB }, null);
</code></pre></div></div>

<p>Last command sends just one byte which requests current settings. When it’s received method <code class="language-plaintext highlighter-rouge">XBeeFrameReceived</code> gets called. You can put breakpoint into the empty <code class="language-plaintext highlighter-rouge">case</code> statement or print incoming data. Format is described in table below.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>_xBee.SendData(0x0013A200407A26AA, 0xFFFE, new byte[] { 24 }, null);
</code></pre></div></div>

<h3 id="commands">Commands</h3>

<table>
<thead>
<tr><th>ID</th><th>Name</th><th>Data</th><th>Description</th></tr>
</thead>
<tbody>
<tr>
<td>20</td>
<td>Fade delay</td>
<td>high byte, low byte</td>
<td>0 - 65535 milliseconds</td>
</tr>
<tr>
<td>21</td>
<td>Mode</td>
<td>mode id</td>
<td>0 - disabled, 1 - single color, 2 - fading, 3 - strobe</td>
</tr>
<tr>
<td>22</td>
<td>Color</td>
<td>color id</td>
<td>0 - Red, 1 - Green, 2 - Blue, 3 - Yellow, 4 - Cyan, 5 - Orange, 6 - Magenta</td>
</tr>
<tr>
<td>23</td>
<td>Color</td>
<td>red byte, green byte, blue byte</td>
<td>0 - 255 for each color</td>
</tr>
<tr>
<td>24</td>
<td>Status</td>
<td colspan="2"><em>returns</em> current settings in format: 25, mode, [fade delay] high, low, [color] R, G, B</td>
</tr>
</tbody>
</table>

<h3 id="source-code">Source code</h3>

<p>Full source code is available on <a href="https://github.com/stlk/RGBLampGateway" title="Link to GitHub.com">GitHub.com</a>.</p>


</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2021/03/13/websockets-on-django-and-react/">
            Websockets on Django and React
            <small>13 Mar 2021</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/08/09/high-speed-request-filtering-using-cloudflare-workers/">
            Hi-speed request filtering using Cloudflare Workers
            <small>09 Aug 2020</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/07/16/pipenv-is-great/">
            Pipenv is great
            <small>16 Jul 2020</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>
  </body>
</html>
