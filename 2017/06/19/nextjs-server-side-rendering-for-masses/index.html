<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="/public/favicon.ico" rel="shortcut icon" type="image/x-icon">
    <link href="http://gmpg.org/xfn/11" rel="profile">

    <title>
      Next.js - server side rendering for masses &middot; 
      Zápisník Josefa Rouska
    </title>

    <meta content="Zápisník Josefa Rouska" property="og:site_name">
    
      <meta content="Next.js - server side rendering for masses" property="og:title">
    
    
      <meta content="article" property="og:type">
      <meta property="article:author" content="https://www.facebook.com/josef.rousek" />
    
    
      <meta name="description" content="Recently I had opportunity to use Next.js on a client project. I already heard how much work it saves but I just couldn’t believe how simple it was.
">
      <meta content="Recently I had opportunity to use Next.js on a client project. I already heard how much work it saves but I just couldn’t believe how simple it was.
" property="og:description">
    
    
      <meta content="https://blog.rousek.name/2017/06/19/nextjs-server-side-rendering-for-masses/" property="og:url">
    
    
      <meta content="2017-06-19T00:00:00-05:00" property="article:published_time">
    
    

    <!-- CSS -->
    <link rel="stylesheet" href="/public/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Abril+Fatface&subset=latin,latin-ext">

    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/public/favicon.png">

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
  </head>
  <body>

    <header class="masthead">
      <div class="masthead-inner">
        <h1><a href="/">Zápisník Josefa Rouska</a></h1>
        <p class="lead">Python a React.js programátor, zaměřený na Shopify integrace</p>

        <div class="colophon">
          <ul class="colophon-links">
            <li><a href="https://rousek.name/">about</a></li>
            <li><a href="https://github.com/stlk">github</a></li>
            <li><a href="https://twitter.com/josefrousek">twitter</a></li>
          </ul>
        </div>

      </div>
    </header>

    <div class="content container">
      <div class="post">
  <h1>Next.js - server side rendering for masses</h1>
  <span class="post-date">19 Jun 2017</span>
  <p>Recently I had opportunity to use <a href="https://github.com/zeit/next.js">Next.js</a> on a client project. I already heard how much work it saves but I just couldn’t believe how simple it was.</p>

<p>My requirements were following. Server rendered react application with jest as testing framework and <a href="https://www.styled-components.com">styled-components</a> as the <em>best</em> way to manage styles. If you aren’t interested in these be sure to checkout <a href="https://zeit.co/blog/next2#more-examples">blogpost announcing version 2.0</a> of Next.js. There’s a bunch of examples showing integrations with other libraries.</p>

<p>To grasp the basics I followed tutorial on <a href="https://learnnextjs.com">Learning Next.js</a>. It got me through some early surprises. Eg. how route resolving is done on the server when using custom routes. But first lets take a look on how you define custom route. Magic is hidden behind the <code class="language-plaintext highlighter-rouge">as</code> attribute and everything is handled automatically.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">Link</span> <span class="k">as</span><span class="o">=</span><span class="p">{</span><span class="s2">`/post/</span><span class="p">${</span><span class="nx">show</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">`</span><span class="p">}</span> <span class="nx">href</span><span class="o">=</span><span class="p">{</span><span class="s2">`/post?id=</span><span class="p">${</span><span class="nx">show</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">`</span><span class="p">}</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">a</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">show</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/a</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/Link&gt;</span></code></pre></figure>

<p>On the other hand server configuration is done on, well, server level. We need to manually define a route and then tell <code class="language-plaintext highlighter-rouge">next.js</code> which page is it. You can use plethora of nodejs servers as backend, but I’ve used the default one which is <code class="language-plaintext highlighter-rouge">express</code>.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">server</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/post/:id</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">actualPage</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">/post</span><span class="dl">'</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">queryParams</span> <span class="o">=</span> <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span> <span class="p">};</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">actualPage</span><span class="p">,</span> <span class="nx">queryParams</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>

<p>Please note that this is required only for server side rendering with custom routes.</p>

<h3 id="styled-components">Styled components</h3>

<p>First library I want to integrate is <a href="https://github.com/zeit/next.js/tree/master/examples/with-styled-components">styled-components</a> integrating this library is pretty simple. Just copy <code class="language-plaintext highlighter-rouge">pages/_document.js</code> from example repo. To not break server side rendering we need to use babel plugin called <code class="language-plaintext highlighter-rouge">babel-plugin-styled-components</code>. Don’t forget to include <code class="language-plaintext highlighter-rouge">.babelrc</code>, I prefer to keep my babel configuration in <code class="language-plaintext highlighter-rouge">package.json</code>.</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hello-next"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"main"</span><span class="p">:</span><span class="w"> </span><span class="s2">"index.js"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"babel"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"presets"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"next/babel"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"plugins"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">[</span><span class="w">
        </span><span class="s2">"styled-components"</span><span class="p">,</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"ssr"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"dev"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node server.js"</span><span class="p">,</span><span class="w">
</span><span class="err">...</span></code></pre></figure>

<h3 id="tests-using-jest">Tests using jest</h3>

<p>To set up jest all you need to do is to add <code class="language-plaintext highlighter-rouge">env</code> to <a href="https://github.com/stlk/next-workshop/blob/master/package.json#L33">babel presets</a>.</p>

<p>I also have a <a href="https://github.com/stlk/next-workshop/blob/master/test.js">script</a> that will automatically disable <code class="language-plaintext highlighter-rouge">watch</code> when run on CI server.</p>

<h3 id="want-to-learn-more">Want to learn more?</h3>

<p>You can follow my progress on <a href="https://github.com/stlk/next-workshop">GitHub.com</a>.</p>

<h3 id="školení-nextjs">Školení Next.js</h3>

<p>Vedu <a href="https://react.coffee/#react-na-serveru">Next.js workshop</a>, kde si vyzkoušíme Next.js v praxi.</p>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2021/03/13/websockets-on-django-and-react/">
            Websockets on Django and React
            <small>13 Mar 2021</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/08/09/high-speed-request-filtering-using-cloudflare-workers/">
            Hi-speed request filtering using Cloudflare Workers
            <small>09 Aug 2020</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/07/16/pipenv-is-great/">
            Pipenv is great
            <small>16 Jul 2020</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>
    <!-- Fathom - beautiful, simple website analytics -->
    <script src="https://cdn.usefathom.com/script.js" data-site="NAKOBGAG" defer></script>
    <!-- / Fathom -->
  </body>
</html>
