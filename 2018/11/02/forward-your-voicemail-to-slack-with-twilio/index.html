<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="/public/favicon.ico" rel="shortcut icon" type="image/x-icon">
    <link href="http://gmpg.org/xfn/11" rel="profile">

    <title>
      Forward your voicemail to Slack with Twilio &middot; 
      Zápisník Josefa Rouska
    </title>

    <meta content="Zápisník Josefa Rouska" property="og:site_name">
    
      <meta content="Forward your voicemail to Slack with Twilio" property="og:title">
    
    
      <meta content="article" property="og:type">
      <meta property="article:author" content="https://www.facebook.com/josef.rousek" />
    
    
      <meta name="description" content="This post expands on the previous one I wrote on this topic. Please refer back to Virtual support phone number with Twilio if you’re not familiar with Twilio.
">
      <meta content="This post expands on the previous one I wrote on this topic. Please refer back to Virtual support phone number with Twilio if you’re not familiar with Twilio.
" property="og:description">
    
    
      <meta content="https://blog.rousek.name/2018/11/02/forward-your-voicemail-to-slack-with-twilio/" property="og:url">
    
    
      <meta content="2018-11-02T00:00:00-05:00" property="article:published_time">
    
    

    <!-- CSS -->
    <link rel="stylesheet" href="/public/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Abril+Fatface&subset=latin,latin-ext">

    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/public/favicon.png">

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
  </head>
  <body>

    <header class="masthead">
      <div class="masthead-inner">
        <h1><a href="/">Zápisník Josefa Rouska</a></h1>
        <p class="lead">Python a React.js programátor, zaměřený na Shopify integrace</p>

        <div class="colophon">
          <ul class="colophon-links">
            <li><a href="https://rousek.name/">about</a></li>
            <li><a href="https://github.com/stlk">github</a></li>
            <li><a href="https://twitter.com/josefrousek">twitter</a></li>
          </ul>
        </div>

      </div>
    </header>

    <div class="content container">
      <div class="post">
  <h1>Forward your voicemail to Slack with Twilio</h1>
  <span class="post-date">02 Nov 2018</span>
  <p>This post expands on the previous one I wrote on this topic. Please refer back to <a href="/2018/09/09/virtual-business-phone-number-with-twilio/">Virtual support phone number with Twilio</a> if you’re not familiar with Twilio.</p>

<p>Following up from last time. We have voice-enabled phone number <em>+420999999999</em>. Now We’ll setup call forwarding and voicemail for this number.</p>

<h3 id="twilio-functions">Twilio Functions</h3>

<p>Functions are a way to run your logic directly on Twilio servers. We’ll use them to construct TwiML response and then to send a message to Slack.</p>

<h3 id="recording-voicemail-message">Recording voicemail message</h3>

<p><a href="https://www.twilio.com/console/runtime/functions/manage">Runtime &gt; Functions</a> is the place where we can manage our Functions.</p>

<p>Create a new function called <code class="language-plaintext highlighter-rouge">Record message</code> and paste following code. Replace <code class="language-plaintext highlighter-rouge">YOUR_RUNTIME_DOMAIN</code> with your Runtime Domain from <a href="https://www.twilio.com/console/runtime/overview">Runtime Overview</a> page.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">twiml</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twilio</span><span class="p">.</span><span class="nx">twiml</span><span class="p">.</span><span class="nx">VoiceResponse</span><span class="p">();</span>

  <span class="c1">// Use &lt;Dial&gt; to forward the call to my phone</span>
  <span class="kd">const</span> <span class="nx">dial</span> <span class="o">=</span> <span class="nx">twiml</span><span class="p">.</span><span class="nx">dial</span><span class="p">({</span>
    <span class="na">callerId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">+420999999999</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">});</span>
  <span class="nx">dial</span><span class="p">.</span><span class="nx">number</span><span class="p">(</span><span class="dl">'</span><span class="s1">+420111111111</span><span class="dl">'</span><span class="p">);</span>

  <span class="c1">// Use &lt;Say&gt; to give the caller some instructions</span>
  <span class="nx">twiml</span><span class="p">.</span><span class="nx">say</span><span class="p">(</span><span class="dl">'</span><span class="s1">We</span><span class="se">\'</span><span class="s1">re not available right now. Please leave a message after the beep.</span><span class="dl">'</span><span class="p">);</span>

  <span class="c1">// Use &lt;Record&gt; to record the caller's message</span>
  <span class="nx">twiml</span><span class="p">.</span><span class="nx">record</span><span class="p">({</span><span class="na">action</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://YOUR_RUNTIME_DOMAIN/slack</span><span class="dl">'</span><span class="p">});</span>

  <span class="c1">// End the call with &lt;Hangup&gt;</span>
  <span class="nx">twiml</span><span class="p">.</span><span class="nx">hangup</span><span class="p">();</span>

  <span class="c1">// return the TwiML</span>
  <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">twiml</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<p class="post__image-center">
  <img src="/public/twilio-function.png" alt="" class="post__image post__image-full-width" />
</p>

<p>You probably noticed that <code class="language-plaintext highlighter-rouge">record</code> command is pointing to <code class="language-plaintext highlighter-rouge">/slack</code> URL. This will be another function. But before we can create it we need to add new npm package to our <a href="https://www.twilio.com/console/runtime/functions/configure">Runtime &gt; Functions &gt; Configure</a>. The package is called <a href="https://github.com/axios/axios">axios</a> and will help us with making HTTP request to Slack.</p>

<p class="post__image-center">
  <img src="/public/twilio-function-config.png" alt="" class="post__image post__image-full-width" />
</p>

<p>There’s one more thing before we can get to the function and that is Slack Webhook URL. Luckily you can get one by visiting <a href="https://slack.com/apps/A0F7XDUAZ-incoming-webhooks">Slack App Directory</a>. After that, we’ll have everything we need to create a Function.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">axios</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">axios</span>
    <span class="p">.</span><span class="nx">post</span><span class="p">(</span>
      <span class="dl">"</span><span class="s2">https://hooks.slack.com/services/TOKEN</span><span class="dl">"</span><span class="p">,</span>
      <span class="p">{</span>
        <span class="na">text</span><span class="p">:</span> <span class="s2">`You have received a message from </span><span class="p">${</span>
          <span class="nx">event</span><span class="p">.</span><span class="nx">From</span>
        <span class="p">}</span><span class="s2">.\nTo listen to this message, please visit this URL:</span><span class="p">${</span>
          <span class="nx">event</span><span class="p">.</span><span class="nx">RecordingUrl</span>
        <span class="p">}</span><span class="s2">.mp3`</span>
      <span class="p">}</span>
    <span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
      <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="dl">"</span><span class="s2">OK</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
      <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="dl">"</span><span class="s2">FAIL</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">};</span>
</code></pre></div></div>

<p>This Function takes the phone number of the caller and recording URL. Then POSTs a message to Slack. Now you’ll get a message when somebody leaves you a message.</p>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2021/03/13/websockets-on-django-and-react/">
            Websockets on Django and React
            <small>13 Mar 2021</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/08/09/high-speed-request-filtering-using-cloudflare-workers/">
            Hi-speed request filtering using Cloudflare Workers
            <small>09 Aug 2020</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/07/16/pipenv-is-great/">
            Pipenv is great
            <small>16 Jul 2020</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>
    <!-- Fathom - beautiful, simple website analytics -->
    <script src="https://cdn.usefathom.com/script.js" data-site="NAKOBGAG" defer></script>
    <!-- / Fathom -->
  </body>
</html>
