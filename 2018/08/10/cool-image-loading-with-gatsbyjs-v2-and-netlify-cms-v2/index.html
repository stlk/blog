<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="/public/favicon.ico" rel="shortcut icon" type="image/x-icon">
    <link href="http://gmpg.org/xfn/11" rel="profile">

    <title>
      Cool image loading with Gatsby.js v2 and Netlify CMS v2 &middot; 
      Zápisník Josefa Rouska
    </title>

    <meta content="Zápisník Josefa Rouska" property="og:site_name">
    
      <meta content="Cool image loading with Gatsby.js v2 and Netlify CMS v2" property="og:title">
    
    
      <meta content="article" property="og:type">
      <meta property="article:author" content="https://www.facebook.com/josef.rousek" />
    
    
      <meta name="description" content="Time has come and even I got the opportunity to try out currently trending Gatsby.js static site generator. The most popular feature, at least from my point of view, is Image Processing with gatsby-transformer-sharp. I thought “Everyone talks that I can have out of the box responsive images and other cool things!”. Yeah sure, but they didn’t use it together with Netlify CMS while using beta of v2 :) Now with Gatsby v2 released things are a bit easier.
">
      <meta content="Time has come and even I got the opportunity to try out currently trending Gatsby.js static site generator. The most popular feature, at least from my point of view, is Image Processing with gatsby-transformer-sharp. I thought “Everyone talks that I can have out of the box responsive images and other cool things!”. Yeah sure, but they didn’t use it together with Netlify CMS while using beta of v2 :) Now with Gatsby v2 released things are a bit easier.
" property="og:description">
    
    
      <meta content="https://blog.rousek.name/2018/08/10/cool-image-loading-with-gatsbyjs-v2-and-netlify-cms-v2/" property="og:url">
    
    
      <meta content="2018-08-10T00:00:00-05:00" property="article:published_time">
    
    

    <!-- CSS -->
    <link rel="stylesheet" href="/public/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Abril+Fatface&subset=latin,latin-ext">

    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/public/favicon.png">

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

    <script async defer data-domain="blog.rousek.name" src="https://plausible.io/js/plausible.js"></script>
  </head>
  <body>

    <header class="masthead">
      <div class="masthead-inner">
        <h1><a href="/">Zápisník Josefa Rouska</a></h1>
        <p class="lead">Python a React.js programátor, zaměřený na Shopify integrace</p>

        <div class="colophon">
          <ul class="colophon-links">
            <li><a href="https://rousek.name/">about</a></li>
            <li><a href="https://github.com/stlk">github</a></li>
            <li><a href="https://twitter.com/josefrousek">twitter</a></li>
          </ul>
        </div>

      </div>
    </header>

    <div class="content container">
      <div class="post">
  <h1>Cool image loading with Gatsby.js v2 and Netlify CMS v2</h1>
  <span class="post-date">10 Aug 2018</span>
  <p>Time has come and even I got the opportunity to try out currently trending Gatsby.js static site generator. The most popular feature, at least from my point of view, is <a href="https://image-processing.gatsbyjs.org/">Image Processing with gatsby-transformer-sharp</a>. I thought “Everyone talks that I can have out of the box responsive images and other cool things!”. Yeah sure, but they didn’t use it together with Netlify CMS while using beta of v2 :) Now with Gatsby v2 released things are a bit easier.</p>

<p>Getting started with something as complex as Gatsby.js is always a challenge. Looking back I would compare Gatsby to Webpack. Complexity of plugin based processing pipeline makes it a bit harder to understand than good old static site generators.</p>

<p>Now let’s investigate what do we actually need to make this work. Here are the plugins we need.</p>

<h3 id="gatsby-plugin-sharp">gatsby-plugin-sharp</h3>
<p>Exposes several image processing functions built on the Sharp.</p>

<h3 id="gatsby-transformer-sharp">gatsby-transformer-sharp</h3>
<p>Makes it possible to query <a href="https://github.com/lovell/sharp">Sharp image processing library</a> processed images using GraphQL.</p>

<h3 id="gatsby-transformer-remark">gatsby-transformer-remark</h3>

<p>Uses <a href="https://github.com/remarkjs/remark">remark</a> to parse the markdown files into usable data nodes for GraphQL.</p>

<h3 id="gatsby-remark-images">gatsby-remark-images</h3>
<p>This does the magic making images linked from markdown files responsive.</p>

<h3 id="gatsby-plugin-netlify-cms-paths">gatsby-plugin-netlify-cms-paths</h3>
<p>This is where the fun begins! Gatsby assumes that images are colocated with posts. This approach doesn’t work with Netlify CMS, because it stores images in a single place.</p>

<p>I ended up with this configuration:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">netlifyCmsPaths</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">resolve</span><span class="p">:</span> <span class="s2">`gatsby-plugin-netlify-cms-paths`</span><span class="p">,</span>
  <span class="na">options</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">cmsConfig</span><span class="p">:</span> <span class="s2">`/static/admin/config.yml`</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">}</span>

<span class="p">...</span>

<span class="nx">netlifyCmsPaths</span><span class="p">,</span> <span class="c1">// Including in your Gatsby plugins will transform any paths in your frontmatter</span>
<span class="s2">`gatsby-transformer-sharp`</span><span class="p">,</span>
<span class="s2">`gatsby-plugin-sharp`</span><span class="p">,</span>
<span class="p">{</span>
  <span class="na">resolve</span><span class="p">:</span> <span class="s2">`gatsby-transformer-remark`</span><span class="p">,</span>
  <span class="na">options</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span>
      <span class="nx">netlifyCmsPaths</span><span class="p">,</span> <span class="c1">// Including in your Remark plugins will transform any paths in your markdown body</span>
      <span class="p">{</span>
        <span class="na">resolve</span><span class="p">:</span> <span class="s2">`gatsby-remark-images`</span><span class="p">,</span>
        <span class="na">options</span><span class="p">:</span> <span class="p">{</span>
          <span class="c1">// It's important to specify the maxWidth (in pixels) of</span>
          <span class="c1">// the content container as this plugin uses this as the</span>
          <span class="c1">// base for generating different widths of each image.</span>
          <span class="na">maxWidth</span><span class="p">:</span> <span class="mi">930</span><span class="p">,</span>
          <span class="na">backgroundColor</span><span class="p">:</span> <span class="dl">'</span><span class="s1">transparent</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// required to display blurred image first</span>
        <span class="p">},</span>
      <span class="p">},</span>
    <span class="p">],</span>
<span class="p">},</span>
</code></pre></div></div>

<p>These are the versions that I’m using:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"gatsby-plugin-sharp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"latest"</span><span class="err">,</span><span class="w">
</span><span class="nl">"gatsby-remark-images"</span><span class="p">:</span><span class="w"> </span><span class="s2">"latest"</span><span class="err">,</span><span class="w">
</span><span class="nl">"gatsby-transformer-remark"</span><span class="p">:</span><span class="w"> </span><span class="s2">"latest"</span><span class="err">,</span><span class="w">
</span><span class="nl">"gatsby-transformer-sharp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"latest"</span><span class="err">,</span><span class="w">
</span><span class="nl">"gatsby-plugin-netlify-cms-paths"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.0.2"</span><span class="err">,</span><span class="w">
</span></code></pre></div></div>

<p>When Gatsby is configured this way I can embed image in markdown file like this <code class="language-plaintext highlighter-rouge">![Chemex](/img/chemex.jpg)</code> and get this awesome loading “blur up” behavior.</p>

<p class="post__image-center">
    <video width="600" src="/public/gatsby-loading.mp4" autoplay="" loop="">
    </video>
</p>

<h2 id="working-with-images-stored-in-frontmatter">Working with images stored in frontmatter</h2>

<p>The blog I was working on has image displayed in the blog post list. The cover image was defined in frontmatter as follows.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">templateKey</span><span class="pi">:</span> <span class="s">blog-post</span>
<span class="na">title</span><span class="pi">:</span> <span class="s">The ultimate Chemex guide</span>
<span class="na">cover_image</span><span class="pi">:</span> <span class="s">/img/chemex.jpg</span>
</code></pre></div></div>

<p>With all important bits in place let’s try running <code class="language-plaintext highlighter-rouge">gatsby develop</code>, open http://localhost:8000/___graphql and run this query. You should see that image was processed.</p>

<div class="language-graphql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="n">allMarkdownRemark</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">edges</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">node</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">frontmatter</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="n">title</span><span class="w">
          </span><span class="n">cover_image</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="n">childImageSharp</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="n">fluid</span><span class="p">(</span><span class="n">maxWidth</span><span class="p">:</span><span class="w"> </span><span class="mi">700</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="n">src</span><span class="w">
              </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre></div></div>

<p>On <code class="language-plaintext highlighter-rouge">index.js</code> page, I can then use this GraphQL query combined with <a href="https://www.gatsbyjs.org/packages/gatsby-image/#gatsby-image">gatsby-image</a> package. This package provides wrapper around <code class="language-plaintext highlighter-rouge">img</code> tag to generate HTML required to display responsive images. <code class="language-plaintext highlighter-rouge">GatsbyImageSharpFluid</code> is a fragment provided by <code class="language-plaintext highlighter-rouge">gatsby-image</code> its result we will then pass to <code class="language-plaintext highlighter-rouge">Img</code> component.</p>

<div class="language-graphql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cover_image</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">childImageSharp</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">fluid</span><span class="p">(</span><span class="n">maxWidth</span><span class="p">:</span><span class="w"> </span><span class="mi">630</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="p">...</span><span class="n">GatsbyImageSharpFluid</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">Img</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">gatsby-image</span><span class="dl">'</span>

<span class="o">&lt;</span><span class="nx">Img</span> <span class="nx">fluid</span><span class="o">=</span><span class="p">{</span><span class="nx">post</span><span class="p">.</span><span class="nx">frontmatter</span><span class="p">.</span><span class="nx">cover_image</span><span class="p">.</span><span class="nx">childImageSharp</span><span class="p">.</span><span class="nx">fluid</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span></code></pre></div></div>

<p>You can see entire component and website on <a href="https://github.com/Liduska/personal-blog/blob/master/src/pages/index.js#L45">GitHub</a>.</p>

<p>Overall I like Gatsby. I it’s one of the two static site generators I enjoy using. The other being <a href="https://jekyllrb.com/">Jekyll</a>.</p>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2021/03/13/websockets-on-django-and-react/">
            Websockets on Django and React
            <small>13 Mar 2021</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/08/09/high-speed-request-filtering-using-cloudflare-workers/">
            Hi-speed request filtering using Cloudflare Workers
            <small>09 Aug 2020</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/07/16/pipenv-is-great/">
            Pipenv is great
            <small>16 Jul 2020</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>
  </body>
</html>
